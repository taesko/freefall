<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Account transfers reports</title>
  <link href="../css/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="./css/jquery-ui.css" rel="stylesheet">
  <link href="./css/main.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    {{> heading }}
    {{> menu }}
    {{> messages }}
    <div class="row">
      <h3>Filter:</h3>
      <form action="/transfers" method="get">
        <div class="col-md-6">
          <div class="form-group form-inline">
            <label>User email:</label>
            <input class="form-control" type="email" name="user-email" placeholder="Email" value="{{ filters.user_email }}">
            <select class="form-control">
              <option value="">No grouping</option>
              <option>Group by email</option>
            </select>
          </div>
          <div class="form-group">
            <label>Type of transaction</label>
            <select name="type" class="form-control">
              <option value="all" {{ is_selected transaction_type "all" }}>All</option>
              <option value="deposits" {{ is_selected transaction_type "deposits" }}>Only deposits</option>
              <option value="withdrawals" {{ is_selected transaction_type "withdrawals" }}>Only withdrawals</option>
            </select>
          </div>
          <div class="form-group">
            <label>Reason for transaction:</label>
            <select name="reason" class="form-control">
              <option value="all" {{ is_selected transaction_reason "all" }}>All</option>
              <option value="employee" {{ is_selected transaction_reason "employee" }}>Only transfers by employes</option>
              <option value="new-subscription" {{ is_selected transaction_reason "new-subscription" }}>Only new subscription taxes</option>
              <option value="fetch" {{ is_selected transaction_reason "fetch" }}>Only fetch taxes</option>
            </select>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label>Date from:</label>
            <input id="date-from" name="date-from" class="form-control" type="text" value="{{ filters.date_from }}">
          </div>
          <div class="form-group">
            <label>Date to:</label>
            <input id="date-to" name="date-to" class="form-control" type="text" value="{{ filters.date_to }}">
          </div>
          <div class="form-group">
            <select class="form-control">
              <option>No grouping</option>
              <option>Group by seconds</option>
              <option>Group by minutes</option>
              <option>Group by hours</option>
              <option>Group by days</option>
              <option>Group by weeks</option>
              <option>Group by months</option>
              <option>Group by years</option>
            </select>
          </div>
          <div class="form-group">
            <input class="btn btn-primary" type="submit">
          </div>
        </div>
      </form>
    </div>
    <hr>
    <div class="row">
      <div class="col-md-6">
        <h3>Current filter data:</h3>
        <p><label>Total deposited:</label> {{filter_total_deposited}}</p>
        <p><label>Total withdrawn:</label> {{filter_total_withdrawn}}</p>
        <button id="export-xlsx-btn" class="btn btn-primary">Export as XLSX</button>
      </div>
      <div class="col-md-6">
        <p><label>Credits spent by all users:</label> {{users_total_spent_credits}}</p>
        <p><label>Credits owned by all users:</label> {{users_total_credits}}</p>
        <p><label>Credits loaded into system:</label> {{total_credits_loaded}}</p>
        <p><label>Amount of requests to Dalipeche:</label> {{dalipeche_api_total_requests}}</p>
      </div>
    </div>
    <hr>
    <div class="row">
      <div class="col-md-4">
        {{#if prev_page}}
        <p class="text-left">
          <button class="btn btn-default" onclick="location.href='/transfers?page={{prev_page}}{{query_string_without_page}}';">Previous page</button>
        </p>
        {{/if}}
      </div>
      <div class="col-md-4">
        <p class="text-center">
          Page:
          <label>{{page}}</label>
        </p>
      </div>
      <div class="col-md-4">
        {{#if next_page}}
        <p class="text-right">
          <button class="btn btn-default" onclick="location.href='/transfers?page={{next_page}}{{query_string_without_page}}';">Next page</button>
        </p>
        {{/if}}
      </div>
    </div>
    <div class="table-wrap">
      <table id="account-transfers-table" class="table table-bordered">
        <thead>
          <tr>
            <th>Id</th>
            <th>User</th>
            <th>Deposits</th>
            <th>Withdrawals</th>
            <th>Transferred at</th>
            <th>Employee transferrer id</th>
            <th>Employee transferrer email</th>
            <th>User subscription airport from</th>
            <th>User subscription airport to</th>
            <th>User subscription date from</th>
            <th>User subscription date to</th>
            <th>Subscription airport from</th>
            <th>Subscription airport to</th>
            <th>Fetch time</th>
          </tr>
        </thead>
        <tbody>
          {{#each account_transfers}}
          <tr>
            <td class="text-right">
              {{this.account_transfer_id}}
            </td>
            <td>
              {{this.user.email}}
              <a href="/users/{{this.user.id}}">(open)</a>
            </td>
            <td class="text-right">
              {{this.deposit_amount}}
            </td>
            <td class="text-right">
              {{this.withdrawal_amount}}
            </td>
            <td>
              {{this.transferred_at}}
            </td>
            <td>
              {{this.employee_transferrer_id}}
            </td>
            <td>
              {{this.employee_transferrer_email}}
              {{#if this.employee_transferrer_id}}
                <a href="/employees/{{this.employee_transferrer_id}}">(open)</a>
              {{/if}}
            </td>
            <td>
              {{user_subscr_airport_from_name}}
            </td>
            <td>
              {{user_subscr_airport_to_name}}
            </td>
            <td>
              {{user_subscr_date_from}}
            </td>
            <td>
              {{user_subscr_date_to}}
            </td>
            <td>
              {{fetch_time}}
            </td>
            <td>
              {{subscr_airport_from_name}}
            </td>
            <td>
              {{subscr_airport_to_name}}
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
    <div class="row">
      <div class="col-md-4">
        {{#if prev_page}}
        <p class="text-left">
          <button class="btn btn-default" onclick="location.href='/transfers?page={{prev_page}}{{query_string_without_page}}';">Previous page</button>
        </p>
        {{/if}}
      </div>
      <div class="col-md-4">
        <p class="text-center">
          Page:
          <label>{{page}}</label>
        </p>
      </div>
      <div class="col-md-4">
        {{#if next_page}}
        <p class="text-right">
          <button class="btn btn-default" onclick="location.href='/transfers?page={{next_page}}{{query_string_without_page}}';">Next page</button>
        </p>
        {{/if}}
      </div>
    </div>
  </div>
  <script src="../js/lodash/index.min.js"></script>
  <script src="../js/ajv.min.js"></script>
  <script src="../js/js-yaml/js-yaml.min.js"></script>
  <script src="../js/json-schemas.js"></script>
  <script src="../js/admin-json-schemas.js"></script>
  <script src="../js/parsers.js"></script>
  <script src="../js/api-methods.js"></script>
  <script src="../js/admin-api-methods.js"></script>
  <script src="../js/main.js"></script>
  <script src="./js/jquery/jquery-2.2.4.js"></script>
  <script src="./js/jquery-ui.min.js"></script>
  <script>
    var filtersGlobal = {
      user_email: _.unescape('{{{escape filters.user_email}}}'),
      date_from: _.unescape('{{{escape filters.date_from}}}'),
      date_to: _.unescape('{{{escape filters.date_to}}}'),
      type: _.unescape('{{{escape transaction_type}}}'),
      reason: _.unescape('{{{escape transaction_reason}}}'),
    };
  </script>
  <script src="./js/xlsx.full.min.js"></script>
  <script src="./js/account-transfers.js"></script>
</body>
</html>
